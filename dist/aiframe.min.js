function aiframe(elem){this.elem=elem;var self=this;elem.aiframeInstance=this;this.defaultSelector=null;this.setSelector=function(selector){this.defaultSelector=selector};this.load=function(url,data,selector){selector=selector||this.defaultSelector;this.createXhr(url,data,function(error,xhr){if(error){return console.error(xhr)}if(!selector){self.elem.innerHTML=xhr.responseText}else{var tmp=document.createElement("div");tmp.innerHTML=xhr.responseText;while(self.elem.firstChild){self.elem.removeChild(self.elem.firstChild)}var match=tmp.querySelector(selector);if(match){self.elem.appendChild(match)}else{self.elem.appendChild(tmp)}}self.handleEvents()})};this.handleEvents=function(){this.elem.removeEventListener("click",this.clickHandler);this.elem.addEventListener("click",this.clickHandler);var forms=this.elem.querySelectorAll("form");Array.prototype.forEach.call(forms,function(form){form.addEventListener("submit",self.submitHandler)})};this.clickHandler=function(event){var closestAnchor=findClosestElement(event.target,"a");if(!closestAnchor){if(elementMatches(event.target,"input[type=submit]")){event.target.setAttribute("checked",true)}return}if(!closestAnchor.href){return}var target=closestAnchor.getAttribute("target");if(target&&target!=="_self"){return}var href=closestAnchor.getAttribute("href",2);if(self.isExternalLink(href)){return}event.preventDefault();getaiframe(closestAnchor).load(href)};this.submitHandler=function(event){var form=event.target;var action=form.getAttribute("action");if(self.isExternalLink(action)){return}event.preventDefault();var formData=new FormData(form);var clickedSubmitButton=form.querySelector("input[type=submit][checked]");if(clickedSubmitButton){formData.append(clickedSubmitButton.name,clickedSubmitButton.value)}getaiframe(form).load(action,formData)};this.isExternalLink=function(url){return false};function getaiframe(elem){while(elem){if(elem.aiframeInstance){return elem.aiframeInstance}elem=elem.parentNode}return false}function elementMatches(elem,selector){var matches=(this.document||this.ownerDocument).querySelectorAll(selector),i=matches.length;while(--i>=0&&matches.item(i)!==elem){}return i>-1}function findClosestElement(elem,match){while(!elementMatches(elem,match)){if(!elem.parentNode){return false}elem=elem.parentNode}return elem}}aiframe.reactive=function(){function scan(target){if(target&&!target.querySelectorAll){return}(target||document).querySelectorAll("[aiframe], [aiframe-load]").forEach(function(elem){var aiframeInstance=new aiframe(elem);if(elem.hasAttribute("aiframe-select")){aiframeInstance.setSelector(elem.getAttribute("aiframe-select"))}if(elem.hasAttribute("aiframe-load")){aiframeInstance.load(elem.getAttribute("aiframe-load"))}})}scan(document);document.addEventListener("DOMNodeInserted",function(event){scan(event.target)})};aiframe.setReactive=function(){document.addEventListener("DOMContentLoaded",aiframe.reactive)};aiframe.prototype.createXhr=function(url,data,callback){if(typeof data==="function"){callback=data;data=null}var xhrObject=new XMLHttpRequest;var method=data?"POST":"GET";xhrObject.onreadystatechange=function(){if(this.readyState==4){if(this.status===200){callback(null,this)}else{callback(true,this)}}};xhrObject.open(method,url,true);xhrObject.send(data);return xhrObject};if(typeof module==="undefined"){aiframe.setReactive()}else{module.exports=aiframe}
